/**
 * Максимальная сумма одной операции (в единицах валюты, не в копейках).
 * Защита от случайного ввода гигантских чисел.
 */
const MAX_AMOUNT = 100_000;

/**
 * Валидация суммы: не более 2 знаков после запятой, только положительные числа.
 *
 * Почему это важно в финансовых приложениях:
 *
 * Сервер хранит деньги как целые числа (int64) в минимальных единицах валюты
 * (копейки, центы, filsi и т.д.) — это стандартная практика в финтехе.
 * Например: 100.50 KES хранится как 10050 в базе данных.
 *
 * Причины такого подхода:
 * 1. Числа с плавающей точкой (float) дают погрешности при арифметике.
 *    Например: 0.1 + 0.2 = 0.30000000000000004 в JavaScript.
 *    В финансах такие расхождения недопустимы — это реальные деньги.
 * 2. Целые числа (int64) хранятся и сравниваются точно, без округлений.
 * 3. Ограничение в 2 знака соответствует делимости большинства валют (1/100).
 *
 * Поэтому: клиент валидирует до 2 знаков, умножает на 100 перед отправкой,
 * а сервер получает всегда корректное целое число.
 */
export const getValidationError = (value: string): string | null => {
  if (!value || value.trim() === "") {
    return "Введите сумму";
  }

  const trimmed = value.trim();

  // Проверяем формат ПЕРЕД parseFloat, чтобы отсечь "1e5", "abc" и т.д.
  // Допускаем: "100", "100.5", "100.50", ".5", "0.99"
  if (!/^\d*\.?\d+$/.test(trimmed)) {
    return "Введите корректное число";
  }

  const num = parseFloat(trimmed);

  if (num <= 0) {
    return "Сумма должна быть больше нуля";
  }

  if (num > MAX_AMOUNT) {
    return `Максимальная сумма — ${MAX_AMOUNT.toLocaleString("ru-RU")}`;
  }

  // Проверка на максимум 2 знака после запятой
  // Отдельная проверка — чтобы дать точное сообщение об ошибке
  const dotIndex = trimmed.indexOf(".");
  if (dotIndex !== -1) {
    const decimals = trimmed.length - dotIndex - 1;
    if (decimals > 2) {
      return "Максимум 2 знака после запятой (например: 100.50)";
    }
  }

  return null; // null = валидно
};
