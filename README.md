# Player Balances

Приложение для управления балансами игроков. Позволяет просматривать список устройств, открывать список игроков каждого устройства и выполнять финансовые операции — пополнение и снятие средств.

**Живое демо:** [Live](https://dev-space.su/swagger/index.html)
**API:** [Swagger документация](https://dev-space.su/swagger/index.html)

---

## Стек технологий

| Инструмент               | Назначение      | Причина выбора                                         |
| ------------------------ | --------------- | ------------------------------------------------------ |
| React + TypeScript       | UI и типизация  | Строгая типизация, предсказуемый код                   |
| Vite                     | Сборщик         | Быстрый HMR, минимальная конфигурация                  |
| React Bootstrap          | UI-компоненты   | Готовые адаптивные компоненты, быстрая вёрстка         |
| TanStack Query           | Серверный стейт | Кеширование, состояния загрузки, автоматический рефетч |
| Axios                    | HTTP-клиент     | Удобные интерцепторы, типизированные ответы            |
| React Router             | Навигация       | URL-навигация, стандарт для SPA                        |
| React Toastify           | Уведомления     | Toast-уведомления с анимацией из коробки               |
| Vitest + Testing Library | Тесты           | Нативная интеграция с Vite, быстрый запуск             |

---

## Архитектура

Проект построен по методологии **Feature-Sliced Design (FSD)** — послойная архитектура с однонаправленным потоком зависимостей.

```
shared → entities → features → widgets → pages → app
```

Каждый слой может импортировать только из слоёв ниже себя. Это исключает циклические зависимости и делает код предсказуемым.

### Слои приложения

**`shared/`** — фундамент, не зависит ни от чего. Содержит: настроенный axios-инстанс, TypeScript-интерфейсы из Swagger, переиспользуемые UI-компоненты (Loader, ErrorAlert), константы конфигурации.

**`entities/`** — бизнес-сущности. `device` содержит API-функции и React Query хуки для устройств. `player` содержит UI-компонент карточки игрока.

**`features/`** — действия пользователя. `balance` содержит компонент управления балансом (BalanceControl) и логику валидации, вынесенную в отдельный файл `model/validation.ts`.

**`widgets/`** — составные блоки. `DeviceList` и `PlayerList` собирают entities и features в готовые секции страницы.

**`pages/`** — страницы приложения. Каждая страница компонует нужные виджеты и отвечает только за layout и роутинг-параметры.

**`app/`** — точка входа. Инициализация провайдеров (QueryClient), роутинг, глобальные стили.

### Работа с деньгами

Сервер хранит балансы как целые числа `int64` в минимальных единицах валюты (аналог копеек). Например, `10050` означает `100.50 KES`. Это стандартная практика в финтехе, позволяющая избежать погрешностей чисел с плавающей точкой (`0.1 + 0.2 = 0.30000000000000004` в JavaScript).

Приложение обрабатывает это в двух местах:

- **Отображение:** `balances / 100` с форматированием через `toLocaleString` (`10050` → `100.50`)
- **Отправка:** `Math.round(amount * 100)` перед отправкой на сервер (`100.50` → `10050`)

---

## Запуск проекта

### Требования

- Node.js 18+
- npm 9+

### Локальная разработка

```bash
# Установить зависимости
npm install

# Запустить dev-сервер
npm run dev
```

Приложение будет доступно на `http://localhost:5173`

### Сборка

```bash
npm run build
```

### Тесты

```bash
# Запустить все тесты один раз
npm run test:run

# Запустить тесты в watch-режиме
npm run test
```

Покрытие тестами: 8 unit-тестов для функции валидации и 6 integration-тестов для компонента BalanceControl — итого 14 тестов.

---

## Структура проекта

```
src/
├── app/              # Инициализация, провайдеры, роутинг
├── entities/
│   ├── device/       # API, хуки, карточка устройства
│   └── player/       # Карточка игрока
├── features/
│   └── balance/      # Управление балансом, валидация
├── pages/            # DevicesPage, DevicePage, NotFoundPage
├── shared/           # API-инстанс, типы, конфиг, UI-атомы
├── test/             # Конфигурация тестовой среды
└── widgets/          # DeviceList, PlayerList
```
